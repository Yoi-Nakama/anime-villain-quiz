<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Which Anime Villain Are You?</title>
  <!-- GOOGLE FONTS -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Press+Start+2P:wght@700&family=UnifrakturCook:wght@700&family=Faster+One:wght@700&family=Oswald:wght@700&family=Fira+Mono:wght@700&family=Luckiest+Guy:wght@700&family=Black+Ops+One:wght@700&family=Permanent+Marker:wght@700&family=VT323:wght@700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: linear-gradient(120deg, #20123a 0%, #1a0037 80%, #191222 100%);
      background-image:
        repeating-linear-gradient(0deg, rgba(255,255,255,0.012) 0, rgba(255,255,255,0.012) 1px, transparent 1px, transparent 24px),
        repeating-linear-gradient(90deg, rgba(255,255,255,0.014) 0, rgba(255,255,255,0.014) 1px, transparent 1px, transparent 24px);
      overflow-x: hidden;
      overflow-y: auto;
      box-sizing: border-box;
      font-family: 'Orbitron', 'Roboto', 'Fira Mono', 'Oswald', 'Press Start 2P', 'UnifrakturCook', 'Faster One', 'Luckiest Guy', 'Black Ops One', 'Permanent Marker', 'VT323', Arial, sans-serif;
      color: #fff;
      font-weight: bold;
    }
    * { font-weight: bold !important; letter-spacing: 0.01em;}
    #particles-js {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      z-index: -2;
      pointer-events: none;
    }
    .center-hero {
      min-height: 100vh; min-height: 100svh;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      position: relative; z-index: 1; box-sizing: border-box;
    }
    .main-title-gradient {
      font-family: 'Orbitron', 'Press Start 2P', cursive;
      font-size: 2.6rem; font-weight: bold;
      background: linear-gradient(90deg, #ff1e56 0%, #ff53a7 60%, #ffac41 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text; text-fill-color: transparent;
      letter-spacing: 3px; text-align: center; line-height: 1.1em;
      margin-bottom: 30px; margin-top: 0px; filter: drop-shadow(0 0 8px #ff1e56);
      user-select: none; z-index: 2; text-shadow: none;
      transition: filter 0.25s;
    }
    .main-title-gradient:hover {
      filter: drop-shadow(0 0 16px #ffac41) drop-shadow(0 0 8px #ff1e56);
    }
    .start-btn {
      font-family: 'Orbitron', 'Press Start 2P', cursive;
      font-size: 1.5rem;
      background: linear-gradient(90deg, #2a1643 0%, #ff1e56 98%);
      border: none; color: #fff;
      padding: 20px 54px; border-radius: 22px; cursor: pointer;
      box-shadow: 0 0 22px #ff1e56, 0 0 2px #fff;
      letter-spacing: 2px; outline: none; margin-bottom: 18px; margin-top: 10px;
      transition: box-shadow 0.33s, filter 0.2s, transform 0.13s;
      animation: startBtnPulse 2.1s infinite alternate cubic-bezier(.4,1.2,.6,1);
      z-index: 3; display: block; font-weight: bold;
    }
    @keyframes startBtnPulse {
      0% { box-shadow: 0 0 20px #ff1e56; filter: brightness(1);}
      100% { box-shadow: 0 0 36px #ffac41; filter: brightness(1.05);}
    }
    .start-btn:active { transform: scale(0.97); filter: brightness(0.98);}
    .start-btn:hover { box-shadow: 0 0 46px #ffac41, 0 0 6px #fff; filter: brightness(1.14) saturate(1.2);}
    .headphone-wrap {
      display: flex; align-items: center; justify-content: center;
      flex-direction: column; margin-bottom: 28px; margin-top: 14px;
      z-index: 4; user-select: none;
    }
    .headphone-svg {
      width: 68px; height: 68px; display: block; margin: 0 auto 7px auto;
      filter: drop-shadow(0 0 10px #ff1e56) drop-shadow(0 0 6px #fff);
      animation: headphonePulse 2.4s infinite alternate;
    }
    @keyframes headphonePulse {
      0% { filter: drop-shadow(0 0 6px #ff1e56);}
      100% { filter: drop-shadow(0 0 24px #ffac41);}
    }
    .headphone-note {
      font-size: 1.2rem; color: #fff;
      font-family: 'Orbitron', 'Press Start 2P', cursive;
      text-shadow: none; letter-spacing: 1.1px; margin-bottom: 5px; margin-top: 0;
      text-align: center; animation: none !important; font-weight: bold;
    }
    .audio-uploader {
      margin-top: 15px; margin-bottom: 6px; text-align: center; z-index: 10;
      font-family: 'Fira Mono', 'Orbitron', monospace; color: #ffac41;
      background: rgba(31,0,47,0.12); border-radius: 12px;
      padding: 8px 20px 10px 20px; box-shadow: 0 0 7px #ff1e56, 0 0 2px #fff;
      border: 2px solid #ffac41; display: flex; flex-direction: column; align-items: center;
      gap: 4px; width: 320px; max-width: 95vw; font-weight: bold;
    }
    .audio-uploader input[type="file"] { margin-top: 2px; margin-bottom: 3px; font-weight: bold;}
    .audio-upload-label {
      font-size: 1.0rem; color: #ff1e56; letter-spacing: 1px;
      text-shadow: none; margin-bottom: 2px; margin-top: 1px; display: block; font-weight: bold;
    }
    .audio-upload-list {
      padding: 0; margin: 0; list-style: none; width: 100%; font-size: 0.98rem;
      color: #fff; max-width: 98%; text-align: left; font-weight: bold;
    }
    .audio-upload-list li { margin: 1px 0 2px 0; word-break: break-all; white-space: pre-line; font-weight: bold;}
    .quiz-box, .result-box {
      display: flex; flex-direction: column; align-items: center;
      background: rgba(22, 0, 36, 0.93); padding: 36px 32px 30px 32px;
      border-radius: 24px; min-width: 340px; max-width: 94vw; margin: auto;
      animation: fadeIn 0.9s; margin-bottom: 18px; position: relative; overflow: hidden;
      box-shadow: 0 0 14px #2c003e; font-weight: bold;
    }
    .result-box {
      border: 4px solid #ff1e56; box-shadow: 0 0 18px #ff1e56; transition: border-color .3s;
      background: #191222 !important; display: none; opacity: 0; pointer-events: none;
      justify-content: center; align-items: center; z-index: 10001;
      position: fixed; left: 50%; top: 50%; transform: translate(-50%,-50%);
      max-width: 95vw; max-height: 95vh; overflow-y: auto; box-sizing: border-box; font-weight: bold;
    }
    .result-box.show { display: flex !important; opacity: 1; pointer-events: auto; animation: resultPopIn 1.1s cubic-bezier(.5,2.2,.4,1.1);}
    @keyframes resultPopIn { 0% { opacity: 0; transform: translate(-50%,-50%) scale(0.7);} 80% { opacity: 1; transform: translate(-50%,-50%) scale(1.09);} 100% { opacity: 1; transform: translate(-50%,-50%) scale(1);}}
    .result-box.naruto { border-color: #ff9900; }
    .result-box.jjk { border-color: #19ffb6; }
    .result-box.bleach { border-color: #2340ff; }
    .result-box.deathnote { border-color: #fff800; }
    .result-box.demonslayer { border-color: #ff0e43; }
    .result-box.myhero { border-color: #47a3ff; }
    .result-box.berserk { border-color: #b2aec2; }
    .result-box.dbz { border-color: #e5c800; }
    .result-box.jojo { border-color: #b400ff; }
    .result-box .classic-overlay {
      pointer-events: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      opacity: 0.09; background: url('https://i.imgur.com/HnGdhEw.png'); background-size: cover; z-index: 1;
    }
    .result-box img {
      width: 270px; margin: 25px 0 15px 0; border-radius: 16px;
      box-shadow: 0 0 10px #ff1e56; background: #222; object-fit: contain;
      border: 3px solid #ff1e56; animation: villainPop 0.8s; z-index: 2; filter: brightness(1.12);
      transition: filter 0.6s; font-weight: bold;
    }
    @keyframes villainPop { 0% { transform: scale(0.5) rotate(-10deg);} 80% { transform: scale(1.1) rotate(2deg);} 100% { transform: scale(1) rotate(0);}}
    .result-box h2 { font-size: 1.5rem; color: #fff; font-family: 'Orbitron', 'Press Start 2P', cursive; text-shadow: none; margin: 0 0 18px 0; z-index: 2; font-weight: bold;}
    .result-form-label { font-size: 1.1rem; color: #ffac41; font-family: 'Orbitron', 'Press Start 2P', cursive; margin-bottom: 7px; margin-top: 0; text-shadow: none; z-index: 2; font-weight: bold;}
    .anime-title {
      display: inline-block; font-size: 1.3rem; font-family: 'Orbitron', 'Press Start 2P', cursive; letter-spacing: 2.5px;
      margin-bottom: 8px; margin-top: 0; padding: 6px 22px; border-radius: 14px; font-weight: bold;
      border-width: 3px; border-style: solid; background: rgba(20,0,32,0.82); color: #fff;
      box-shadow: none; border-color: #ff1e56; text-shadow: none; animation: animeTitleSlide 0.8s cubic-bezier(.46,2.1,.52,.96);
      z-index: 2; position: relative; font-weight: bold;
    }
    @keyframes animeTitleSlide { 0% { transform: translateY(-80px) scale(0.7) skewX(-12deg); opacity: 0;} 70% { transform: translateY(10px) scale(1.11) skewX(3deg); opacity: 1;} 100% { transform: translateY(0) scale(1) skewX(0); opacity: 1;}}
    .anime-title.naruto      { border-color: #ff9900; color: #ff9900; }
    .anime-title.jjk         { border-color: #19ffb6; color: #19ffb6; }
    .anime-title.bleach      { border-color: #2340ff; color: #5d8aff; }
    .anime-title.deathnote   { border-color: #fff800; color: #fff800; }
    .anime-title.demonslayer { border-color: #ff0e43; color: #ff0e43; }
    .anime-title.myhero      { border-color: #47a3ff; color: #47a3ff; }
    .anime-title.berserk     { border-color: #b2aec2; color: #b2aec2; }
    .anime-title.dbz         { border-color: #e5c800; color: #e5c800; }
    .anime-title.jojo        { border-color: #b400ff; color: #b400ff; }
    .villain-quote {
      min-height: 48px; margin: 14px 0 0 0; font-size: 1.09rem; letter-spacing: 1.1px; border-left: 3px solid #ff1e56;
      padding-left: 12px; white-space: pre-line; opacity: 0.99; margin-bottom: 12px; color: #fff; text-shadow: none; z-index: 2; font-weight: bold;
    }
    .font-madara { font-family: 'Black Ops One', 'Orbitron', 'Press Start 2P', sans-serif; font-weight: bold; text-transform:uppercase; color: #f54257; letter-spacing:2.5px;}
    .font-sukuna { font-family: 'Permanent Marker', 'Oswald', cursive; font-weight: bold; color: #19ffb6;}
    .font-aizen { font-family: 'Oswald', 'Orbitron', serif; font-weight: bold; color: #5d8aff; letter-spacing:1.5px; }
    .font-light { font-family: 'Fira Mono', monospace; font-weight: bold; color: #fff800;}
    .font-muzan { font-family: 'UnifrakturCook', cursive; font-weight: bold; color: #ff0e43;}
    .font-geto { font-family: 'VT323', monospace; font-weight: bold; color: #76f2ff;}
    .font-dabi { font-family: 'Luckiest Guy', cursive; font-weight: bold; color: #47a3ff;}
    .font-griffith { font-weight: bold; color: #d4d1e1;}
    .font-frieza { font-family: 'Faster One', cursive; font-weight: bold; color: #e5c800; letter-spacing:2.5px;}
    .font-dio { font-family: 'UnifrakturCook', cursive; font-weight: bold; color: #b400ff;}
    .result-box.dabi, .font-dabi { animation: none; }
    .result-box.aizen, .font-aizen { animation: none; }
    .threat-meter-wrap { width: 220px; margin: 0 0 14px 0; background: #2c003e; border-radius: 10px; overflow: hidden; box-shadow: 0 0 5px #ff1e56; z-index: 2; font-weight: bold;}
    .threat-meter {
      height: 18px; background: linear-gradient(90deg,#1aff00 0%, #dada00 55%, #c90000 100%);
      width: 0%; transition: width 1.1s cubic-bezier(.4,1.2,.6,1); border-radius: 10px; box-shadow: 0 0 7px #ffac41; font-weight: bold;
    }
    .threat-label { font-family: 'Orbitron', 'VT323', monospace; font-size: 1.05rem; color: #ffac41; letter-spacing: 1.7px; text-shadow: none; margin-bottom: 2px; z-index: 2; font-weight: bold;}
    .restart-btn { margin-top: 26px; border-color: #ffac41; box-shadow: 0 0 7px #ffac41; background: rgba(255, 172, 65, 0.12); color: #ffac41; z-index: 2; font-weight: bold;}
    .restart-btn:hover { background: #ffac41; color: #1a0037; border-color: #fff;}
    html, body, .center-hero, .quiz-box, .result-box { overflow-y: auto !important; box-sizing: border-box;}
    @media (max-width: 600px) {
      .main-title-gradient { font-size: 1.3rem; }
      .quiz-box, .result-box { padding: 18px 4vw; min-width: unset;}
      .anime-title { font-size: 1rem; padding: 4px 8px;}
      .question { font-size: 1rem;}
      .audio-uploader { width: 95vw; }
    }
  </style>
</head>
<body>
  <div id="particles-js"></div>
  <audio id="sfx" src="https://cdn.pixabay.com/audio/2022/03/15/audio_119bfae6e4.mp3"></audio>
  <audio id="villain-music"></audio>
  <audio id="bgm-audio" preload="auto"></audio>
  <div class="center-hero" id="start-screen">
    <div class="main-title-gradient" id="main-title-anim">Which Anime Villain Are You?</div>
    <div class="headphone-wrap">
      <svg class="headphone-svg" viewBox="0 0 72 72" fill="none">
        <circle cx="36" cy="36" r="35" stroke="#ff1e56" stroke-width="2" fill="rgba(255,30,86,0.03)"/>
        <path d="M20,52 Q17,47 17,36 Q17,25 26,18 Q36,10 46,18 Q55,25 55,36 Q55,47 52,52" stroke="#ffac41" stroke-width="4" fill="none"/>
        <rect x="13" y="45" width="10" height="15" rx="5" fill="#ffac41" stroke="#ff1e56" stroke-width="2"/>
        <rect x="49" y="45" width="10" height="15" rx="5" fill="#ffac41" stroke="#ff1e56" stroke-width="2"/>
        <circle cx="36" cy="23" r="4" fill="#ff1e56" stroke="#fff" stroke-width="1"/>
        <text x="36" y="68" text-anchor="middle" font-size="20" fill="#ff1e56" font-family="Orbitron, Arial" dy="0.22em">🎧</text>
      </svg>
      <span class="headphone-note">Please wear headphones <br>for better experience!</span>
    </div>
    <div class="audio-uploader" id="audio-uploader">
      <span class="audio-upload-label">Upload your own songs (mp3):</span>
      <input type="file" id="audio-upload-input" accept="audio/mp3,audio/mpeg" multiple>
      <ul class="audio-upload-list" id="audio-upload-list"></ul>
      <span style="font-size:0.93em;color:#ffac41">Your song will play when you click Start</span>
    </div>
    <button class="start-btn" id="start-btn" onclick="showLoadingAnim()"><span>▶</span> START GAME</button>
  </div>
  <!-- LOADING, JUMPSCARE, QUIZ, RESULT -->
  <div class="loading-anim-wrap" id="loading-anim" style="display:none;">
    <div class="blood-drop"></div>
    <div class="blood-splatter"></div>
    <div class="smoke-anim">
      <div class="smoke-cloud c1"></div>
      <div class="smoke-cloud c2"></div>
      <div class="smoke-cloud c3"></div>
      <div class="smoke-cloud c4"></div>
      <div class="smoke-cloud c5"></div>
    </div>
    <div class="loading-evil-emoji" id="evil-emoji"></div>
  </div>
  <div class="jumpscare-wrap" id="jumpscare" style="display:none;">
    <div class="jumpscare-splatters" id="jumpscare-splatters"></div>
    <div class="jumpscare-smoke" id="jumpscare-smoke"></div>
    <div class="jumpscare-blood">
      <svg viewBox="0 0 320 180"><path fill="#c90000" d="M41,90 Q60,140 100,100 Q160,40 220,100 Q260,140 279,90 Q260,120 160,160 Q60,120 41,90Z"/></svg>
    </div>
    <div class="jumpscare-text" id="jumpscare-text">Calculating result...<br/>Please wait...</div>
  </div>
  <div class="quiz-box" id="quiz-box" style="display:none;">
    <div class="progress-bar-bg">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
    <div class="question" id="question"></div>
    <div class="options">
      <button class="option-btn" onclick="playSound();answerWithLoading('A')" id="btnA"></button>
      <button class="option-btn" onclick="playSound();answerWithLoading('B')" id="btnB"></button>
      <button class="option-btn" onclick="playSound();answerWithLoading('C')" id="btnC"></button>
      <button class="option-btn" onclick="playSound();answerWithLoading('D')" id="btnD"></button>
    </div>
  </div>
  <div class="result-box" id="result" style="display:none;"></div>
  <script>
    particlesJS.load('particles-js', 'https://cdn.jsdelivr.net/gh/VincentGarreau/particles.js/particles.json');
    function playSound() { document.getElementById('sfx').currentTime=0; document.getElementById('sfx').play(); }
    const defaultSongs = [
      { name: "Crimson Blood", src: "Crimson%20Blood%20.mp3" },
      { name: "Crimson Blood (1)", src: "Crimson%20Blood%20%20(1).mp3" },
      { name: "Endless Room", src: "Endless%20Room.mp3" },
      { name: "Endless Room (1)", src: "Endless%20Room%20(1).mp3" }
    ];
    let userSongs = [];
    let allSongs = [...defaultSongs];
    const audioInput = document.getElementById('audio-upload-input');
    const audioList = document.getElementById('audio-upload-list');
    audioInput.addEventListener('change', function() {
      userSongs = [];
      audioList.innerHTML = "";
      for(const file of audioInput.files) {
        if (file.type.startsWith('audio/')) {
          const url = URL.createObjectURL(file);
          userSongs.push({ name: file.name, src: url });
          let li = document.createElement('li');
          li.textContent = "🎵 " + file.name;
          audioList.appendChild(li);
        }
      }
      allSongs = userSongs.length > 0 ? [...userSongs] : [...defaultSongs];
    });
    const bgmAudio = document.getElementById('bgm-audio');
    let currentBgm = null;
    function playRandomBgm() {
      if (allSongs.length === 0) return;
      const idx = Math.floor(Math.random() * allSongs.length);
      currentBgm = allSongs[idx];
      bgmAudio.src = currentBgm.src;
      bgmAudio.volume = 0.6;
      bgmAudio.currentTime = 0;
      setTimeout(() => { bgmAudio.play().catch(()=>{}); }, 220);
    }
    function stopBgm() { bgmAudio.pause(); bgmAudio.currentTime = 0; }
    function getAnimeBoxClass(anime) {
      anime = anime.toLowerCase();
      if (anime.includes("naruto")) return "naruto";
      if (anime.includes("jujutsu")) return "jjk";
      if (anime.includes("bleach")) return "bleach";
      if (anime.includes("death note")) return "deathnote";
      if (anime.includes("demon slayer")) return "demonslayer";
      if (anime.includes("my hero")) return "myhero";
      if (anime.includes("berserk")) return "berserk";
      if (anime.includes("dragon ball")) return "dbz";
      if (anime.includes("jojo")) return "jojo";
      return "";
    }
    const villainFonts = {
      madara: "font-madara", sukuna: "font-sukuna", aizen: "font-aizen", light: "font-light", muzan: "font-muzan",
      geto: "font-geto", dabi: "font-dabi", griffith: "font-griffith", frieza: "font-frieza", dio: "font-dio"
    };
    const villainThreat = {
      madara: "Threat Level: God", sukuna: "Threat Level: Cataclysmic", aizen: "Threat Level: Supreme",
      light: "Threat Level: Genius", muzan: "Threat Level: Immortal", geto: "Threat Level: Cult Leader",
      dabi: "Threat Level: Unstable", griffith: "Threat Level: Charismatic", frieza: "Threat Level: Galactic", dio: "Threat Level: Vampire King"
    };
    const villainThreatPercent = { madara: 100, sukuna: 98, aizen: 95, light: 80, muzan: 97, geto: 89, dabi: 80, griffith: 86, frieza: 93, dio: 92 };
    const questions = [
      { q: "You just gained power overnight. What’s the first thing you’d do?", options: ["Help the weak","Crush my enemies","Change the system","Test it on someone... for fun"] },
      { q: "Your friend betrays you. How do you respond?", options: ["Forgive but never forget","Eliminate them without emotion","Make them regret it eternally","Smile and plot quietly"] },
      { q: "Pick your weapon in a life-or-death battle.", options: ["Words and manipulation","Raw strength and fear","Strategy and illusion","Love... turned into pain"] },
      { q: "If the world hated you, what would you become?", options: ["Its ruler","Its destroyer","Its savior… secretly","I’d laugh and embrace chaos"] },
      { q: "Your biggest desire deep down is…?", options: ["Peace at any cost","To be remembered","Control everything","Love, even if it hurts others"] }
    ];
    const villainForms = {
      madara: [ { name: "Madara, God of War", image: "https://i.imgur.com/zL8xGfg.png", quote: "Wake up to reality. Nothing ever goes as planned in this world.", bgColor: "#2f1434", music: "" } ],
      sukuna: [ { name: "Sukuna, King of Curses", image: "https://i.imgur.com/iRIe5g1.png", quote: "Know your place, fool.", bgColor: "#44141a", music: "" } ],
      aizen: [ { name: "Aizen, Calm Strategist", image: "https://i.imgur.com/2T8s4aA.png", quote: "Admiration is the emotion farthest from understanding.", bgColor: "#19304e", music: "" } ],
      light: [ { name: "Light Yagami, Justice-Twisted", image: "https://i.imgur.com/UvQwRNC.png", quote: "I am Justice!", bgColor: "#3b211f", music: "" } ],
      muzan: [ { name: "Muzan, Demon King", image: "https://i.imgur.com/aO6w1Cw.png", quote: "I am a perfect being.", bgColor: "#212424", music: "" } ],
      geto: [ { name: "Geto Suguru, Cursed Idealist", image: "https://i.imgur.com/w6P0w5x.png", quote: "Only those with power have the right to decide how it’s used.", bgColor: "#1b2631", music: "" } ],
      dabi: [ { name: "Dabi, Blue Flame", image: "https://i.imgur.com/l9sYXJb.png", quote: "The present you’re so proud of is built on the sacrifices of the past.", bgColor: "#23334e", music: "" } ],
      griffith: [ { name: "Griffith, Betrayer", image: "https://i.imgur.com/CXkL6kM.png", quote: "If you’re alone… become the king.", bgColor: "#232134", music: "" } ],
      frieza: [ { name: "Frieza, Prideful Tyrant", image: "https://i.imgur.com/Kh3Ht0Q.png", quote: "You dare defy the emperor?!", bgColor: "#251a30", music: "" } ],
      dio: [ { name: "Dio Brando, Devilish Mastermind", image: "https://i.imgur.com/zR7BeVZ.png", quote: "You thought it was someone else? It was me, Dio!", bgColor: "#3b1f3b", music: "" } ]
    };
    const villains = [
      { key: "madara", name: "Madara Uchiha", anime: "Naruto", vibe: "God complex, war-driven, mastermind" },
      { key: "sukuna", name: "Sukuna", anime: "Jujutsu Kaisen", vibe: "Chaotic, prideful, savage" },
      { key: "aizen", name: "Sosuke Aizen", anime: "Bleach", vibe: "Calm genius, manipulative" },
      { key: "light", name: "Light Yagami", anime: "Death Note", vibe: "Justice-twisted, god complex" },
      { key: "muzan", name: "Muzan Kibutsuji", anime: "Demon Slayer", vibe: "Heartless, controlling" },
      { key: "geto", name: "Suguru Geto", anime: "JJK", vibe: "Anti-heroic, cursed idealist" },
      { key: "dabi", name: "Dabi (Toya Todoroki)", anime: "My Hero Academia", vibe: "Burned emotions, rebellion" },
      { key: "griffith", name: "Griffith", anime: "Berserk", vibe: "Betrayal, ambition" },
      { key: "frieza", name: "Frieza", anime: "Dragon Ball Z", vibe: "Ruthless conqueror, prideful tyrant" },
      { key: "dio", name: "Dio Brando", anime: "JoJo’s Bizarre Adventure", vibe: "Charismatic, immortal, devilish mastermind" }
    ];
    const scoring = [
      { A: { geto: 3 }, B: { madara: 3, frieza: 2, dabi: 1 }, C: { light: 3, aizen: 2, griffith: 1, muzan: 1, dio: 1 }, D: { sukuna: 3, dio: 2, muzan: 1 } },
      { A: { geto: 3 }, B: { dio: 3, frieza: 2, madara: 1, muzan: 1 }, C: { griffith: 3, dabi: 2, sukuna: 1 }, D: { light: 3, aizen: 2, muzan: 1 } },
      { A: { light: 3, aizen: 2, dio: 1, griffith: 1, geto: 1 }, B: { madara: 3, frieza: 2, dabi: 1, muzan: 1 }, C: { sukuna: 3, griffith: 2, geto: 1 }, D: { muzan: 2 } },
      { A: { madara: 3, light: 2, frieza: 1, griffith: 1, muzan: 1 }, B: { dio: 3, sukuna: 2, dabi: 1 }, C: { geto: 3 }, D: { aizen: 3, griffith: 2, muzan: 1 } },
      { A: { geto: 3 }, B: { griffith: 3, frieza: 2, dio: 1 }, C: { light: 3, aizen: 2, madara: 1, muzan: 1 }, D: { dabi: 3, sukuna: 2, muzan: 1 } }
    ];
    const villainMap = villains.reduce((map, v) => { map[v.key] = v; return map; }, {});
    let current = 0, villainScores = {}, evilScore = 0, quizCompleted = false;
    function showLoadingAnim(betweenQuestions = false) {
      document.getElementById("start-btn").style.display = "none";
      document.getElementById("main-title-anim").style.display = "none";
      document.getElementById("loading-anim").style.display = "flex";
      document.getElementById("audio-uploader").style.display = "none";
      document.querySelector('.headphone-wrap').style.display = "none";
      setEvilEmoji();
      setTimeout(() => {
        document.getElementById("loading-anim").style.display = "none";
        startQuiz();
      }, 1750);
    }
    function showBetweenLoading() {
      document.getElementById("quiz-box").style.display = "none";
      setEvilEmoji();
      document.getElementById("loading-anim").style.display = "flex";
      setTimeout(() => {
        document.getElementById("loading-anim").style.display = "none";
        document.getElementById("quiz-box").style.display = "flex";
      }, 1200);
    }
    function setEvilEmoji() {
      let emoji = "😐";
      if (evilScore <= 1) emoji = "🙂";
      else if (evilScore == 2) emoji = "😏";
      else if (evilScore == 3) emoji = "😈";
      else if (evilScore == 4) emoji = "👿";
      else if (evilScore >= 5) emoji = "🩸";
      document.getElementById("evil-emoji").textContent = emoji;
    }
    function startQuiz() {
      villainScores = {};
      evilScore = 0; current = 0; quizCompleted = false;
      document.getElementById("start-screen").style.display = "none";
      document.getElementById("result").style.display = "none";
      document.getElementById("quiz-box").style.display = "flex";
      stopVillainMusic();
      stopBgm();
      playRandomBgm();
      loadQuestion();
      updateProgress();
    }
    function loadQuestion() {
      if (quizCompleted) return;
      if (current >= questions.length) return;
      const q = questions[current];
      document.getElementById("question").textContent = q.q;
      document.getElementById("btnA").textContent = q.options[0];
      document.getElementById("btnB").textContent = q.options[1];
      document.getElementById("btnC").textContent = q.options[2];
      document.getElementById("btnD").textContent = q.options[3];
      updateProgress();
    }
    function answerWithLoading(letter) {
      if (quizCompleted) return;
      evilScore += isEvilChoice(current, letter) ? 1 : 0;
      showBetweenLoading();
      setTimeout(() => selectAnswer(letter), 800);
    }
    function isEvilChoice(qidx, letter) {
      const evil = [
        { B:1, D:1 }, { B:1, C:1 }, { B:1, C:1 }, { B:1, D:1 }, { C:1, D:1 }
      ];
      return !!evil[qidx][letter];
    }
    function selectAnswer(letter) {
      if (quizCompleted) return;
      const mapping = scoring[current][letter];
      for (const vKey in mapping) {
        villainScores[vKey] = (villainScores[vKey] || 0) + mapping[vKey];
      }
      current++;
      if (current < questions.length) {
        loadQuestion();
      } else {
        quizCompleted = true;
        showJumpscare();
      }
    }
    function updateProgress() {
      let percent = ((current) / questions.length) * 100;
      let bar = document.getElementById("progress-bar");
      if (bar) bar.style.width = percent + "%";
    }
    function showJumpscare() {
      document.getElementById("quiz-box").style.display = "none";
      let jumpscare = document.getElementById("jumpscare");
      let splatters = document.getElementById("jumpscare-splatters");
      let smoke = document.getElementById("jumpscare-smoke");
      splatters.innerHTML = "";
      smoke.innerHTML = "";
      for (let i=0; i<10+Math.floor(Math.random()*4); ++i) {
        let s = document.createElement('div');
        s.className = "jumpscare-splatter";
        let left = Math.random()*90+3;
        let top = Math.random()*60+15;
        let rot = Math.random()*360;
        s.style.left = left+"vw";
        s.style.top = top+"vh";
        s.style.transform = `rotate(${rot}deg) scale(${0.7+Math.random()*1.3})`;
        splatters.appendChild(s);
      }
      for (let i=0; i<10+Math.floor(Math.random()*6); ++i) {
        let sc = document.createElement('div');
        sc.className = "jumpscare-smokecloud";
        let left = Math.random()*90+2;
        let top = Math.random()*70+10;
        let w = 90+Math.random()*150;
        let h = 45+Math.random()*100;
        sc.style.left = left+"vw";
        sc.style.top = top+"vh";
        sc.style.width = w+"px";
        sc.style.height = h+"px";
        smoke.appendChild(sc);
      }
      jumpscare.style.display = "flex";
      document.getElementById("jumpscare-text").innerHTML = "Calculating result...<br>Please wait...";
      setTimeout(() => {
        document.getElementById("jumpscare-text").innerHTML = "<b>!!!</b>";
        jumpscare.querySelector('.jumpscare-blood').style.opacity = 1;
        jumpscare.style.background = "rgba(30,0,0,0.99)";
        let audio = new Audio("https://cdn.pixabay.com/audio/2022/07/26/audio_124bfa70f6.mp3");
        audio.volume = 0.3;
        audio.play();
      }, 1400);
      setTimeout(() => {
        jumpscare.style.display = "none";
        showResult();
      }, 2500);
    }
    function showResult() {
      document.getElementById("quiz-box").style.display = "none";
      let top = Object.entries(villainScores).sort((a, b) => b[1] - a[1])[0];
      let villainKey = top[0];
      let villain = villainMap[villainKey];
      let forms = villainForms[villainKey];
      let form = forms[Math.floor(Math.random() * forms.length)];
      let animeBoxClass = getAnimeBoxClass(villain.anime);
      stopVillainMusic();
      stopBgm();
      if (form.music) {
        const music = document.getElementById("villain-music");
        music.src = form.music;
        music.volume = 0.66;
        music.play();
      }
      let resultBox = document.getElementById("result");
      resultBox.className = `result-box thriller show ${animeBoxClass}`;
      resultBox.style.background = form.bgColor ? form.bgColor : "#191222";
      resultBox.style.display = "flex";
      setTimeout(() => {
        resultBox.innerHTML = `
          <div class="classic-overlay"></div>
          <span class="anime-title ${animeBoxClass}">${villain.anime}</span>
          <span class="result-form-label ${villainFonts[villainKey]}">${form.name}</span>
          <h2 class="${villainFonts[villainKey]}">You Are ${villain.name}!</h2>
          <img src="${form.image}" alt="${villain.name}">
          <div class="threat-label">${villainThreat[villainKey]}</div>
          <div class="threat-meter-wrap"><div class="threat-meter" id="threat-meter"></div></div>
          <div class="villain-quote ${villainFonts[villainKey]}" id="typed-quote"></div>
          <p style="color:#fff;margin:4px 0 4px;"><b>Vibe:</b> ${villain.vibe}</p>
          <button class="restart-btn" onclick="playSound();location.reload()">Play Again</button>
        `;
        setTimeout(() => {
          let percent = villainThreatPercent[villainKey] || 80;
          document.getElementById("threat-meter").style.width = percent + "%";
        }, 200);
        typeOutQuote(form.quote, villainKey);
        document.getElementById("progress-bar").style.width = "100%";
        resultBox.scrollIntoView({behavior: "smooth"});
      }, 450);
    }
    function stopVillainMusic() {
      let music = document.getElementById("villain-music");
      music.pause();
      music.currentTime = 0;
      music.src = "";
    }
    function typeOutQuote(quote, villainKey) {
      let el = document.getElementById("typed-quote");
      el.textContent = "";
      let i = 0;
      let delay = 33;
      function typeChar() {
        if (i < quote.length) {
          el.textContent += quote[i];
          i++;
          let extra = (quote[i-1] === '.' || quote[i-1] === ',' || quote[i-1] === '!' || quote[i-1] === '…') ? 150 : 0;
          setTimeout(typeChar, delay + Math.random()*20 + extra);
        }
      }
      typeChar();
    }
    function centerHero() {
      let hero = document.getElementById("start-screen");
      if (hero) hero.style.height = window.innerHeight + "px";
    }
    window.onload = centerHero;
    window.onresize = centerHero;
  </script>
</body>
</html>